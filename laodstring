-- Load the Orion Library
local OrionLib = loadstring(game:HttpGet(('https://raw.githubusercontent.com/shlexware/Orion/main/source')))()

-- Variables
local player = game:GetService("Players").LocalPlayer
local runService = game:GetService("RunService")
local farming = false
local noclipConnection

-- Function to enable noclip
local function enableNoclip()
    noclipConnection = runService.Stepped:Connect(function()
        for _, part in ipairs(player.Character:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = false
            end
        end
    end)
end

-- Function to disable noclip
local function disableNoclip()
    if noclipConnection then
        noclipConnection:Disconnect()
        noclipConnection = nil
    end
    for _, part in ipairs(player.Character:GetDescendants()) do
        if part:IsA("BasePart") then
            part.CanCollide = true
        end
    end
end

-- Function to move to a target position
local function moveTo(targetPos)
    local character = player.Character
    if not character or not character:FindFirstChild("HumanoidRootPart") then return end
    local hrp = character.HumanoidRootPart
    local bodyVelocity = Instance.new("BodyVelocity")
    bodyVelocity.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
    bodyVelocity.Velocity = Vector3.zero
    bodyVelocity.Parent = hrp

    local direction = (targetPos - hrp.Position).Unit
    bodyVelocity.Velocity = direction * 26 -- FLY_SPEED

    while (hrp.Position - targetPos).Magnitude > 1 do -- ARRIVAL_THRESHOLD
        if not farming then break end
        task.wait()
    end

    bodyVelocity:Destroy()
end

-- Function to get uncollected coins
local function getCoins()
    local coins = {}
    for _, coin in ipairs(workspace:GetDescendants()) do
        if coin:IsA("MeshPart") and coin.Name == "MainCoin" then
            table.insert(coins, coin)
        end
    end
    return coins
end

-- Function to find the closest coin
local function getClosestCoin()
    local coins = getCoins()
    local closestCoin, shortestDistance = nil, math.huge
    for _, coin in ipairs(coins) do
        local distance = (player.Character.HumanoidRootPart.Position - coin.Position).Magnitude
        if distance < shortestDistance then
            shortestDistance, closestCoin = distance, coin
        end
    end
    return closestCoin
end

-- Coin farming loop
local function startFarming()
    while farming do
        local coin = getClosestCoin()
        if not coin then
            task.wait(5)
        else
            moveTo(coin.Position)
            coin:Destroy()
            task.wait(0.1)
        end
    end
end

-- GUI Setup
local Window = OrionLib:MakeWindow({Name = "Coin Farm", HidePremium = false, SaveConfig = false})
local Tab = Window:MakeTab({Name = "Main", Icon = "rbxassetid://4483345998", PremiumOnly = false})
Tab:AddToggle({
    Name = "Coin Farm",
    Default = false,
    Callback = function(state)
        farming = state
        if farming then
            enableNoclip()
            startFarming()
        else
            disableNoclip()
        end
    end
})

-- Initialize
OrionLib:Init()
